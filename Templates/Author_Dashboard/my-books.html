<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Grn Lite - My Books</title>
		{% load static %}
		<link rel="stylesheet" href="{% static 'Front_End/CSS/styles.css' %}" />
		<script>
			// JavaScript to handle adding new books to the list
			function addBook() {
				const bookTitle = document.getElementById("book-title").value;
				const bookDescription =
					document.getElementById("book-description").value;
				const bookCover = document.getElementById("book-cover").files[0];
				const bookLink = document.getElementById("book-link").value; // Get book link input

				if (bookTitle && bookDescription && bookCover) {
					const bookList = document.getElementById("book-list");
					const newBook = document.createElement("div");
					newBook.classList.add("book-item");
					newBook.innerHTML = `
                    <h4>${bookTitle}</h4>
                    <p>${bookDescription}</p>
                    <img src="${URL.createObjectURL(
											bookCover,
										)}" alt="Book Cover" class="book-cover">
                    <p><a href="${bookLink}" target="_blank">View Book</a></p> <!-- Book link -->
                    <button class="btn btn-danger" onclick="removeBook(this)">Remove</button>
                `;
					bookList.appendChild(newBook);
					// Clear the form fields
					document.getElementById("book-title").value = "";
					document.getElementById("book-description").value = "";
					document.getElementById("book-cover").value = ""; // Reset the file input
					document.getElementById("book-link").value = ""; // Reset the book link input
				} else {
					alert("Please fill out all fields before adding a book.");
				}
			}

			// JavaScript to remove a book from the list
			function removeBook(button) {
				button.parentElement.remove();
			}
		</script>
	</head>
	<body>
		<div class="dashboard-container">
			<!-- Sidebar -->
			{% include 'author-sidebar.html' %}
			<!-- Main Content -->
			<main class="main-content">
				<div class="content-header">
					<h1>My Books</h1>
					<p>
						Manage your books, view past submissions, and keep track of your
						projects.
					</p>
				</div>

				<!-- We don't need this section because this will be the manuscript-submission page -->
				<!-- Add New Book Section -->
				{% comment %}
				<div class="add-book-section">
					<h3>Add New Book</h3>
					<form id="add-book-form" class="form-group">
						<div class="form-group">
							<label for="book-title">Book Title:</label>
							<input
								type="text"
								id="book-title"
								name="book-title"
								placeholder="Enter your book title"
								required
							/>
						</div>
						<div class="form-group">
							<label for="book-description">Book Description:</label>
							<textarea
								id="book-description"
								name="book-description"
								placeholder="Enter book description"
								required
							></textarea>
						</div>
						<div class="form-group">
							<label for="book-cover">Upload Book Cover:</label>
							<input
								type="file"
								id="book-cover"
								name="book-cover"
								accept="image/*"
								required
							/>
						</div>
						<!-- New field to add a book link -->
						<div class="form-group">
							<label for="book-link">Book Link (Optional):</label>
							<input
								type="url"
								id="book-link"
								name="book-link"
								placeholder="Enter link to your book (e.g., Amazon, Website)"
							/>
						</div>
						<button type="button" class="btn btn-primary" onclick="addBook()">
							Add Book
						</button>
					</form>
				</div>
				{% endcomment %}

				<!-- Book List Section -->
				<div id="book-list" class="book-list">
					<h1>My Books</h1>
            <p>Here are all the manuscripts you have uploaded:</p>
            <div class="books-container">
                {% for manuscript in manuscripts %}
                    <div class="book-card">
                        <h3>{{ manuscript.title }}</h3>
                        <p><strong>Keywords:</strong> {{ manuscript.keywords.all|join:", " }}</p>
                        <p><strong>Plot Summary:</strong> {{ manuscript.plot_summary }}</p>
                        {% if manuscript.cover_art %}
                            <img src="{{ manuscript.cover_art.url }}" alt="{{ manuscript.title }} Cover Art">
                        {% endif %}
                        <a href="{% url 'my_app:view-project' manuscript.id %}" class="btn btn-primary">View Project</a>
                        <form action="{% url 'my_app:delete-manuscript' manuscript.id %}" method="post" style="display: inline;">
													{% csrf_token %}
													<button type="submit" class="btn btn-danger">Delete Project</button>
											</form>
                        <a href="{{ manuscript.file_path.url }}" download>Download Manuscript</a>
                    </div>
                {% empty %}
                    <p>You haven't uploaded any manuscripts yet.</p>
                {% endfor %}
            </div>
			</main>
		</div>
	</body>
</html>
