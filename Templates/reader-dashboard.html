<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Grn Lite - Reader Dashboard</title>
		{% load static %}

		<link rel="stylesheet" href="{% static 'Front_End/CSS/styles.css' %}" />
		<script>
			document.addEventListener("DOMContentLoaded", () => {
				fetch("/api/manuscripts/")
					.then((response) => response.json())
					.then((data) => {
						const manuscriptList = document.getElementById(
							"available-manuscripts",
						);
						data.manuscripts.forEach((manuscript) => {
							const manuscriptDiv = document.createElement("div");
							manuscriptDiv.classList.add("manuscript-item");
							manuscriptDiv.innerHTML = `
                    ${
											manuscript.cover_art
												? `<img src="${manuscript.cover_art}" alt="${manuscript.title} Cover Art" style="width: 150px;"/>`
												: ""
										}
                    <h3>${manuscript.title}</h3>
                    <p><strong>Author:</strong> ${manuscript.author}</p>
                    <a href="/book-details/${
											manuscript.id
										}/" class="btn btn-primary">View Book Details</a>
                `;
							manuscriptList.appendChild(manuscriptDiv);
						});
					});
			});
			document.addEventListener("DOMContentLoaded", () => {
				fetch("/api/reader-manuscripts/")
					.then((response) => response.json())
					.then((data) => {
						const manuscriptList = document.getElementById(
							"current-manuscripts",
						);
						data.manuscripts.forEach((manuscript) => {
							const manuscriptDiv = document.createElement("div");
							manuscriptDiv.classList.add("manuscript-item");
							manuscriptDiv.innerHTML = `
                                ${
																	manuscript.cover_art
																		? `<img src="${manuscript.cover_art}" alt="${manuscript.title} Cover Art" style="width: 150px;"/>`
																		: ""
																}
                    <h3>${manuscript.title}</h3>
                    <p><strong>Author:</strong> ${manuscript.author}</p>
                    <a href="/feedback-form/${
											manuscript.id
										}/" class="btn feedback-btn">Feedback Form</a>
                `;
							manuscriptList.appendChild(manuscriptDiv);
						});
					});
			});
			function chooseManuscript(manuscriptId) {
				fetch(`/api/choose-manuscript/${manuscriptId}/`, { method: "POST" })
					.then((response) => response.json())
					.then((data) => {
						alert(data.message);
						// Optionally refresh the lists to reflect the change
						location.reload();
					});
			}
		</script>
		<style>
			.content-header h1 {
				font-size: 2rem;
				color: #2c3e50;
				text-align: center;
			}

			.dashboard-grid .card {
				border: 1px solid #ddd;
				border-radius: 10px;
				background-color: #fefefe;
				padding: 15px;
				box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
			}

			.dashboard-grid .card:hover {
				box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
				transform: translateY(-5px);
			}

			.manuscript-item p {
				margin-bottom: 10px !important;
			}

			.manuscript-item a {
				background-color: #4caf50;
				color: white;
				border: none;
				border-radius: 5px;
				padding: 10px 20px;
				cursor: pointer;
				margin-bottom: 20px;
			}

			.feedback-btn {
				background-color: #3498db !important;
			}

			.manuscript-item img {
				border-radius: 5px;
				width: 100%;
				margin-bottom: 10px;
			}
		</style>
	</head>
	<body>
		<div class="dashboard-container">
			<!-- Sidebar -->
			{% include 'reader-sidebar.html' %}
			<!-- Main Content -->
			<main class="main-content">
				<div class="content-header">
					<h1>Welcome Back, Beta Reader!</h1>
					<p>View available manuscripts and manage feedback.</p>
				</div>
				<div class="dashboard-grid">
					<!-- Available Manuscripts -->
					<div class="card">
						<h3>Available Manuscripts</h3>

						<p>View and filter manuscripts available for review.</p>

						<div id="available-manuscripts" class="manuscript-list">
							<!-- Manuscripts will be dynamically populated here -->
						</div>
					</div>

					<!-- Current Feedback -->
					<div class="card">
						<h3>Books You're Working On</h3>
						<p>These are the manuscripts you are currently reviewing.</p>
						<div id="current-manuscripts" class="manuscript-list">
							<!-- Current manuscripts will be dynamically populated here -->
						</div>
					</div>
				</div>
			</main>
		</div>
		<!-- <script src="{% static 'redirectToAuthPage.js' %}"></script> -->
	</body>
</html>
